require([cdnDomain+"/js/zlib/app.js"],function(e){var n=Mom.getUrlParam("multiple")||"false",a=Mom.getUrlParam("showSearch")||"true",t=Mom.getUrlParam("checkType")||"0",r=Mom.getUrlParam("checkChange")||"true";try{$("input[name='checkChange']").trigger("change")}catch(e){}"true"!=a&&$("#has_searchText").parent().hide(),"true"==r?($("input[name='checkChange']").change(function(){var e=Validator.getRadiosValue("checkChange");$(".container").css("display","none"),$(".container").eq(parseInt(e)).css("display","block")}),Validator.setCheckboxValue("checkChange",t)):$(".checkChangeBox").css("display","none"),require(["ztree_my"],function(e){function a(){Api["ajax"+b](k.url,C,function(e){e.success?t(e.rows):Mom.layAlert(e.message)})}function t(n){var a=new e;m=a.loadData($("#officeTree"),n,!1,T),a.registerSearch(m,$("#org_searchText"),"name")}function r(e,n,a,t){m&&(p=a,m.expandNode(a),s())}function s(){var e={};if(p){var n=p,a=p.id;e="1"==n.type?{companyId:a}:{deptId:a}}var t=$.extend(!0,{},{url:Const.admin+"/api/sys/SysUser/list?__noauth=true",data:e,contentType:"Json",checkUser:!1},waitUserOptions.apiCfg||{}),r=t.contentType||"Json",s=t.data||{},i="Json"==r?JSON.stringify(s):s;Api["ajax"+r](t.url,i,function(e){if(e.success){var n=e.rows;p&&$.each(n,function(e,n){n.orgId=p.id,n.nameLabel=n.name}),o(n)}else Mom.layAlert(e.message)})}function o(n){var a=new e,t=[];v.getNodes()&&$.each(v.getNodes(),function(e,n){t.push(n.id)});var r=[];$.each(n,function(e,n){$.inArray(n.id,t)<0&&r.push(n)}),y=a.loadData($("#userTree"),r,!1,N),a.registerSearch(y,$("#wait_searchText"),"name"),l()}function i(e,a,t,r){if(t){var s=v.transformToArray(v.getNodes());if("true"!=n&&s&&s.length>0)return Mom.layMsg("只能选择一个用户"),!1;var o=[];if($.each(s,function(e,n){o.push(n.id)}),$.inArray(t.id,o)>-1)return!1;var i=y.transformToArray(y.getNodes());return y.removeNode(t),v.addNodes(null,t),s.push(t),g(i.length-1,"#userTree"),g(s.length,"#selectedTree"),!0}}function c(e,n,a,t,r){if(null==a&&n.length>0)for(var s=0;s<n.length;s++)i(null,e,n[s]);return!1}function l(){$(".selectAll").unbind("click").bind("click",function(){var e=[],n=y.getNodes();$.each(n,function(n,a){null!=a.isHidden&&0!=a.isHidden||e.push(a)});var a=e.length;a>0&&Mom.layConfirm("确定将（"+a+"）个用户添加到已选列表中吗?",function(n,t){for(var r=0;r<a;r++)i(null,"userTree",e[r]);return!0})})}function u(e){var n=[];if(U&&""!=U){if("[object Array]"===Object.prototype.toString.call(U))n=U;else if("object"==typeof U)U.id&&(n=[U]);else{var t=U.split(",");$.each(t,function(e,a){n.push({id:a,name:a})})}d(n),1==e&&a()}x.url&&""!=x.url?Api["ajax"+J](x.url,C,function(n){n.success?d(n.rows):Mom.layAlert(n.message),1==e&&a()}):0==n.length&&(d([]),a())}function d(n){var a=[];if($.each(n,function(e,n){a.push({id:n.id,name:n.name,nameLabel:"<font color='red'>"+n.name+"</font>"}),A.push(n)}),v)v.addNodes(null,a),g(a.length,"#selectedTree");else{var t=new e;v=t.loadData($("#selectedTree"),a,!1,M),t.registerSearch(v,$("#has_searchText"),"name")}f()}function h(e,n,a,t){if(a){if(y){(p&&a.orgId==p.id||null==a.orgId)&&y.addNodes(null,[a]);var r=y.transformToArray(y.getNodes());g(r.length,"#userTree")}v.removeNode(a);var s=v.transformToArray(v.getNodes());g(s.length,"#selectedTree")}}function f(){$(".hasRevertBtn").unbind("click").bind("click",function(){Mom.layConfirm("所做的人员调整将被还原<br>确定继续吗?",function(e,n){var a=v.transformToArray(v.getNodes());return $.each(a,function(e,n){v.removeNode(n)}),u(!1),s(),!0})})}function g(e,n){e>0?$(n).find(".nodata").hide():$(n).find(".nodata").show()}var m,p,y,v,T=$.extend(!0,{},{callback:{onClick:r}},orgOptions.settting||{}),k=$.extend(!0,{},{url:Const.admin+"/api/sys/SysOrg/orgTree",data:{},contentType:"Json",checkUser:!1},orgOptions.apiCfg||{}),b=k.contentType||"Json",w=k.data||{},C="Json"==b?JSON.stringify(w):w,N=$.extend(!0,{},{view:{selectedMulti:"true"==n},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},callback:{onDblClick:i,beforeDrop:c}},waitUserOptions.settting||{}),A=[],M=$.extend(!0,{},{data:{key:{name:"nameLabel"}},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{isCopy:!1,isMove:!1}},callback:{onDblClick:h}},hasUserOptions.settting||{}),x=$.extend(!0,{},{url:"",data:{},contentType:"Json",checkUser:!1},hasUserOptions.apiCfg||{}),U=hasUserOptions.checkDefaultVal,J=x.contentType||"Json",O=x.data||{};C="Json"==J?JSON.stringify(O):O;window.getCheckValues=function(){var e=v.transformToArray(v.getNodes());if(0==e.length)return Mom.layMsg("请选择用户"),{success:!1,message:"请选择用户"};if(e.length>1&&"true"!=n)return Mom.layMsg("只能选择一个用户"),{success:!1,message:"只能选择一个用户"};if(A.length==e.length){var a=[];$.each(A,function(e,n){a.push(n.id)});for(var t=0,r=0;r<e.length;r++)$.inArray(e[r].id,a)>-1&&t++;if(t==A.length)return{success:!1,oldValues:A,newValues:e,message:"选择的用户没有发生变化"}}return{success:!0,oldValues:A,newValues:e,message:""}},u(!0)})});