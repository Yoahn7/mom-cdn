require([cdnDomain+"/js/zlib/app.js"],function(e){var a=Mom.getUrlParam("multiple")||"false",n=Mom.getUrlParam("noRoot")||"false",t=Mom.getUrlParam("onlyLeaf")||"false",r=Mom.getUrlParam("contentType")||"Form",o=Mom.getUrlParam("oper")||"",i=Mom.getUrlParam("showSearch")||"true";"true"==i&&"user"!=o||$(".searchGroup").hide(),require(["ztree_my"],function(e){var i=new e;window.loadDataUrl=function(e,a,n,t){"Json"==r&&(a=JSON.stringify(a)),Api["ajax"+r](e,a,function(e){e.success?renderData(e.rows,n,t):Mom.layAlert(e.message)})},window.renderData=function(e,n,t){"user"==o?(t=$.extend(!0,{},t||{},{callback:{beforeExpand:function(e,a){var t=$.fn.zTree.getZTreeObj(e);if("1"!=a.type){var r=JSON.stringify({deptId:a.id});Api.ajaxJson(Const.admin+"/api/sys/SysUser/list",r,function(e){e.success?e.rows.length>0?($.each(e.rows,function(e,a){a.isParent=!1}),t.addNodes(a,e.rows),i.checkDefaultVal(t,n)):(a.isParent=!1,t.updateNode(a)):Mom.layAlert(e.message)})}}}}),"false"==a&&(t.check={enable:!0,chkStyle:"radio"})):t=l(t);var r=i.loadData($("#tree"),e,a,t);if("user"==o)for(var s=r.transformToArray(r.getNodes()),d=0;d<s.length;d++)s[d].isParent=!0,s[d].nocheck=!0,r.updateNode(s[d]);i.checkDefaultVal(r,n)},window.getCheckValues=function(){i.treeObj;return i.getCheckValues(n,t)};var l=function(e){var a=0,n={},t={},r={};return saveApi&&saveApi.url&&(a++,$(".searchGroup").find(".btn.searchAll").css("right","26px"),$(".addRoot").removeClass("hide").click(function(){s(saveApi,null,null)}),n.addHoverDom=function(e,a){if(0!=a.id){var n=$("#"+a.tId+"_span");if(a.editNameFlag||$("#addBtn_"+a.tId).length>0)return;var t="<span class='button add' id='addBtn_"+a.tId+"' title='添加子级' onfocus='this.blur();'></span>";n.after(t);var r=$("#addBtn_"+a.tId);r&&r.bind("click",function(){s(saveApi,null,a)})}},t.enable=!0,t.renameTitle="编辑",t.showRenameBtn=function(e,a){return 0!=a.id},r.beforeEditName=function(e,a){return s(saveApi,a,a.getParentNode()),!1}),deleteApi&&deleteApi.url&&(a++,n.removeHoverDom=function(e,a){$("#addBtn_"+a.tId).unbind().remove()},t.enable=!0,t.removeTitle="删除",t.showRemoveBtn=function(e,a){return 0!=a.id},r.beforeRemove=function(e,a){var n="确认删除当前节点",t=a.children;return t&&t.length&&(n+="及所有子节点"),Mom.layConfirm(n+"吗？",function(n,t){var r={ids:a.id};"Json"==deleteApi.contentType&&(r=JSON.stringify(r)),Api["ajax"+deleteApi.contentType||"Form"](deleteApi.url,r,function(n){if(n.success){var t=$.fn.zTree.getZTreeObj(e);t.removeNode(a)}else Mom.layAlert(n.message)})}),!1}),a>0&&(e=$.extend(!0,{},e||{},{view:n,edit:t,callback:r})),e},s=function(e,a,n){layer.prompt({title:"维护",placeholder:"",value:a?a.name:""},function(t,r,o){var i={id:a?a.id:null,name:t,parent:{id:n?n.id:null}};"Json"==e.contentType&&(i=JSON.stringify(i)),Api["ajax"+e.contentType||"Form"](e.url,i,function(e){var r=$.fn.zTree.getZTreeObj("tree");if(saveApi.callback)saveApi.callback(e,r,n,a);else if(a)a.name=t,r.updateNode(a);else{var o=e.WebapiTypeTree,i=[{id:o.id,name:o.name}];r.addNodes(n,i)}}),layer.close(r)})};url?loadDataUrl(url,data,defaultVals,setting):rows&&renderData(rows,defaultVals,setting)})});