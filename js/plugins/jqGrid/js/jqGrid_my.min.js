define([cdnDomain+"/js/plugins/jqGrid/js/grid.locale-cn.js"],function(g){Mom.include("jqGrid_css",cdnDomain+"/js/plugins/jqGrid/css/",["themes/start/jquery-ui-1.8.20.custom.css","ui.jqgrid.css","jqGrid_my.css"]);var c=function(t,s){return $.extend(true,{},{cellEdit:false,caption:"",datatype:"local",mtype:"GET",height:"100%",width:"100%",autowidth:true,forceFit:true,shrinkToFit:true,scroll:false,autoScroll:true,viewrecords:true,rownumbers:false,multiselect:false,grouping:false,rowNum:-1,subGridOptions:{plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:false,selectOnExpand:false,reloadOnExpand:false},loadComplete:function(v){var u="没有找到符合条件的数据"||s.nodataHtml;l(t,v,u)}},s||{})};var l=function(v,w,u){var t=w.records;if(t==0||t==null){var s=$(v).find(".jqgfirstrow>td").length-1;$(v).find(".jqgfirstrow").empty().html("<td style='border:none;text-align:center;vertical-align:top;line-height:36px;color:#333;' colspan='"+s+"'>"+u+"</td>")}};var e=function(v,u){var t=c(v,u);$(v).jqGrid(t);var s=$(v).closest(".jqGridTable-item");if(u.autowidth==false&&u.autoScroll==false){return false}if(s.length>0&&u.data.length>0){h(v,s)}};var f=function(u,v,t){var s=$.extend(true,{},c(u,t),{gridComplete:function(){u=u.substring(0,1)=="#"?u.substring(1):u;var w=$("#"+u+"").getDataIDs(),A=w.length;var x=typeof v=="string"?v.split(","):v,y=x.length,G="";for(var z=0;z<y;z++){G=$.trim(x[z]);for(var F=0;F<A;F++){var B=$("#"+u+"").jqGrid("getRowData",w[F]);var C=1;for(var E=F+1;E<A;E++){var D=$("#"+u+"").jqGrid("getRowData",w[E]);if(B[G]==D[G]){C++;$("#"+u+"").setCell(w[E],G,"",{display:"none"})}else{break}}if(C>1){$("#"+G+""+w[F]+"").attr("rowspan",C);F+=C-1}}}}});$(u).jqGrid(s)};var m=function(w,v,y,t){var u=c(w,v.setting);var s=$.extend(true,{},u,{onSelectRow:function(z){x(z)}});$(w).jqGrid(s);function x(A){var z=v.subApiCfg||{};var B=d(w,z,A);var C=B.data,D=B.contentType;if("Json"==D){C=JSON.stringify(C)}Api["ajax"+D](B.url,C,function(E){if(E.success){if(t){t(E.rows,A);return false}y.setting.data=E.rows;$("#"+y.subTableId).jqGrid("GridUnload");e("#"+y.subTableId,y.setting)}else{Mom.layAlert(E.message)}})}};var k=function(w,u,x,s){u.setting.data=n(u.setting.data,u.setting.setSort);var t=c(w,u.setting);$(w).jqGrid($.extend(true,{},t,{subGrid:true,subGridRowExpanded:function(z,y){v(z,y)}}));r(w,u.setting.data);function v(C,y){var F=[];var B=C+"_t";var D=C+"_pgr";F.push(B);$("#"+C).html("<div class='subTableBox' ><table id='"+B+"' class='scroll'></table><div id='"+D+"' class='scroll'></div></div>");var G=u.subApiCfg||{};var z=d(w,G,y);var A=z.data,E=z.contentType;if("Json"==E){A=JSON.stringify(A)}Api["ajax"+E](z.url,A,function(H){if(H.success){if(s){s(H.rows,B,y);return}else{x.setting.data=H.rows;var I=c("#"+B,x.setting);$("#"+B).jqGrid(I)}}else{Mom.layAlert(H.message)}})}};var d=function(u,E,z){var w=$(u).getRowData(z)||{};var v={data:E.data||{}};var y=E.otherParameters||[];if(y&&y.length>0){var x=(Array==y.constructor);if(x){$(y).each(function(H,G){for(var F in G){v.data[F]=w[G[F]]}})}else{Mom.layAlert("参数格式需为数组对象型，如[{key:value}]")}}var t=E.urlParams;if(t instanceof Array){var D=[];$(t).each(function(F,H){var G=w[H]||"";G?D.push(G):D.push(H)});v.url=E.url+D.join("/")}else{if(t instanceof Object){var s={};for(var B in t){var A=w[t[B]]||"";s.key1=A?A:t[B]}v.url=Mom.extractUrl(E.url,s)}else{v.url=E.url||""}}var C=E.contentType?E.contentType.toLocaleLowerCase():"json";v.contentType=C.replace(C[0],C[0].toUpperCase());return v};var i=function(s){$(s+" input[type=text].editable").each(function(t,u){$(this).parent("td").text($(this).val());$(this).remove()});return $(s).jqGrid("getRowData")};var p=function(u){var v=tableArr=[];tableArr=i(u);$.unique(o);for(var t=0;t<tableArr.length;t++){for(var s=0;s<o.length;s++){if(o[s]==tableArr[t].id){v.push(tableArr[t])}}}return v};var o=[];var q=function(u,s){var t="";return{cellEdit:true,cellsubmit:"clientArray",editurl:"clientArray",onCellSelect:function(w,v){o.push(w);if(w&&w!==t){$(u).saveRow(t,false,"clientArray");$(u).restoreRow(t);$(u).editRow(w,false);t=w}if(s){$("#"+w).find("td").each(function(y,z){var x=/^\d+(\.\d{0,2})?$/;$(u).find("input[type=text]").each(function(){$(this).on("keyup",function(){var B=$(this).parent().attr("aria-describedby"),A=B.split("_").pop();var D=$(this).val();for(var C=0;C<s.length;C++){if(s[C]==A&&!x.test(D)){$(this).val("");Mom.layMsg("请输入数字,且保留两位小数")}}})})})}}}};var r=function(v,s){if(s&&s.length>0){for(var t=0;t<s.length;t++){var u=s[t];if(u.id&&u.childNode==false){$(v).find("tr#"+u.id).find(".sgcollapsed").empty().unbind("click");continue}}}};var n=function(t,u){if(u&&t){for(var s=0;s<t.length;s++){t[s].sort=s+1}}return t};var h=function(s,t){$(window).resize(function(){$(s).setGridWidth(t==(undefined||null)?$(window).width()*1:$(t).width())})};var b=function(s){return $(s).jqGrid("getGridParam","selrow")};var a=function(s){return $(s).jqGrid("getGridParam","selarrrow")};var j=function(s){$(s).jqGrid("getRowData",slt)};return{loadComplete:l,regularTables:e,editRowFn:q,addSort:n,mergerRowCell:f,mainSubTables:k,judgeDate:r,mainfollowTables:m,getEditedData:p,getAllData:i,winResize:h,getCheckId:b,getCheckIds:a,getLastCkeckId:j}});