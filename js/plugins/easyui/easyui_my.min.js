define([cdnDomain+"/js/plugins/easyui/easyui-lang-zh_CN.js"],function(require){var theme="default";Mom.include("easyui_css",cdnDomain+"/js/plugins/easyui/themes/",[theme+"/easyui.css","icon.css","easyui_my.css"]);$.parser.parse();$.extend(jQuery.fn.datagrid.methods,{addEditor:function(jq,param){if(param instanceof Array){$.each(param,function(index,item){var e=$(jq).datagrid("getColumnOption",item.field);e.editor=item.editor})}else{var e=$(jq).datagrid("getColumnOption",param.field);e.editor=param.editor}},removeEditor:function(jq,param){if(param instanceof Array){$.each(param,function(index,item){var e=$(jq).datagrid("getColumnOption",item);e.editor={}})}else{var e=$(jq).datagrid("getColumnOption",param);e.editor={}}}});$.extend($.fn.datagrid.defaults.editors,{checkbox:{init:function(container,options){var inputStr="";if(options){for(var o in options){if(typeof(o)=="object"){}}$(options).each(function(i,o){inputStr+="<label><input type='checkbox' name='"+(o.name||"")+"' value='"+(o.value||"")+"'/>"+o.text+"</label>"})}return $(inputStr).appendTo(container)},getValue:function(target){return $(target).prop("checked")?1:0},setValue:function(target,value){if(value){$(target).prop("checked","checked")}},resize:function(target,width){var input=$(target);if($.boxModel==true){input.width(width-(input.outerWidth()-input.width()))}else{input.width(width)}}}});var dataGridObj={td0EditIndex:undefined,td1EditIndex:undefined,td2EditIndex:undefined,td3EditIndex:undefined,td4EditIndex:undefined,saveItemArr:[],saveAllItemArr:[],arrIndex:-1,getEditIndex:function(id){id=id.substr(1);return eval("this."+id+"EditIndex")},setEditIndex:function(id,val){id=id.substr(1);eval("this."+id+"EditIndex="+val)},startEditing:function(index,id){if(dataGridObj.getEditIndex(id)!=index){if(dataGridObj.endEditing(id)){$(id).datagrid("selectRow",index).datagrid("beginEdit",index);dataGridObj.setEditIndex(id,index)}else{$(id).datagrid("selectRow",dataGridObj.editIndex)}}},endEditing:function(gridTableId){var editIndex=dataGridObj.getEditIndex(gridTableId);if(editIndex==undefined){return true}if($(gridTableId).datagrid("validateRow",editIndex)){$(gridTableId).datagrid("endEdit",editIndex);dataGridObj.setEditIndex(gridTableId,undefined);return true}else{return false}},pushRowData:function(rowData){if(dataGridObj.saveItemArr.length>0){dataGridObj.filterItem(dataGridObj.saveItemArr,rowData);if(dataGridObj.arrIndex==-1){dataGridObj.saveItemArr.push(rowData)}else{dataGridObj.saveItemArr.splice(dataGridObj.arrIndex,1,rowData)}}else{dataGridObj.saveItemArr.push(rowData)}},filterItem:function(arr,item){for(var i=0;i<arr.length;i++){var filterEle=arr[i].id==""?"itemCode":"id";if((arr[i][filterEle])===(item[filterEle])){dataGridObj.arrIndex=i;return}else{dataGridObj.arrIndex=-1}}},mergeCells:function(data,id,field){var mark=1;for(var i=1;i<data.rows.length;i++){if(data.rows[i][field]==data.rows[i-1][field]){mark+=1;$(id).datagrid("mergeCells",{index:i+1-mark,field:field,rowspan:mark})}else{mark=1}}},getAllData:function(ids){dataGridObj.getAllTablesSave();var idLen=ids?ids.length:$(".tableItem").length;if(idLen>0){dataGridObj.saveAllItemArr=[];for(var i=0;i<idLen;i++){var id=ids?ids[i]:".tableItem";var rows=$(id).datagrid("getRows");dataGridObj.saveAllItemArr=dataGridObj.saveAllItemArr.concat(rows)}}return dataGridObj.saveAllItemArr},getSaveItemArr:function(){dataGridObj.getAllTablesSave();return dataGridObj.saveItemArr},getAllTablesSave:function(){var len=$(".tableItemBox").length;for(var i=0;i<len;i++){$("#td"+i).parents(".datagrid-view").siblings(".datagrid-toolbar").find(".icon-save").trigger("click")}},checkDatagridNotNull:function(dgName,dgId,checkRowArr,checkFieldArr){var rows=$(dgId).datagrid("getRows");for(var i=0;checkRowArr&&i<rows.length;i++){if(checkRowArr.contains(i)){$(dgId).datagrid("endEdit",i);var row=rows[i];for(var j=0;checkFieldArr&&j<checkFieldArr.length;j++){var fieldName=checkFieldArr[j];var fieldTitle=$(dgId).datagrid("getColumnOption",fieldName).title;var colVal=$.trim(row[fieldName]);if(!colVal){var rowName=row.pName?row.pName:row.itemName?row.itemName:"";Mom.layAlert('"'+dgName+'":"'+rowName+"--"+fieldTitle+'" 的值不能为空!');return false}}}}return true},eachCheckDataGrid:function(checkDGArr){var checkFlag="";for(var i=0;i<checkDGArr.length;i++){var item=checkDGArr[i];if(!item.dgId){return false}else{checkFlag=dataGridObj.checkDatagridNotNull(item.dgName,item.dgId,item.checkRowArr,item.checkFieldArr)}if(checkFlag==false){return false}}},dataGridResize:function(resizeDiv){$(window).resize(function(){$(resizeDiv).datagrid("resize")})},dataGridOptions:function(tableId,titleName,columns,mergeCellArr){var mergeCellArr=mergeCellArr||[];var that_=this;return{fitColumns:true,rownumbers:false,collapsible:true,singleSelect:true,selectOnCheck:false,checkOnSelect:false,title:titleName,onClickRow:function(index){that_.dg_startEditing(index,tableId)},columns:columns||[[]],onAfterEdit:function(rowIndex,rowData){that_.dg_pushRowData(rowData);that_.dg_setEditIndex(tableId,undefined);that_.dg_forMergeCells(tableId,mergeCellArr)},onLoadSuccess:function(data){loadedData=data;$(tableId).datagrid("resize");that_.dg_forMergeCells(tableId,mergeCellArr)},toolbar:[{text:"存1",iconCls:"icon-save",handler:function(){$(tableId).datagrid("endEdit",dataGridObj.getEditIndex(tableId))}}]}},forMergeCells:function(tableId,mergeCellArr){var len=mergeCellArr.length;if(len>0){for(var i=0;i<len;i++){dataGridObj.mergeCells(loadedData,tableId,mergeCellArr[i])}}},};var treeGridObj={onBeforeExpand:function(row){},removeTreegridNode:function(tableId,id){$(tableId).treegrid("remove",id)},appendTreegridNode:function(tableId,parentId,dataArr){if(Object.prototype.toString.call(dataArr)!="[object Array]"){dataArr=[dataArr]}$(tableId).treegrid("append",{parent:parentId,data:dataArr});if(parentId){$(tableId).treegrid("refresh",parentId);$(tableId).treegrid("expand",parentId)}},updateNodeState:function(row,children){if(!row){return}if(!children||children.length==0){$("tr[node-id='"+row.id+"']").find(".tree-expanded").removeClass("tree-expanded").addClass("tree-indent");$("tr[node-id='"+row.id+"']").find(".tree-folder").removeClass("tree-folder").removeClass("tree-folder-open").addClass("tree-file");row.state="open"}},editTreegridNode:function(tableId,id,data){delete data.children;$(tableId).treegrid("update",{id:id,row:data});$(tableId).treegrid("refresh",id)},treeGridResize:function(resizeDiv){$(window).resize(function(){$(resizeDiv).datagrid("resize")})},};return{dg_getEditIndex:dataGridObj.getEditIndex,dg_setEditIndex:dataGridObj.setEditIndex,dg_startEditing:dataGridObj.startEditing,dg_endEditing:dataGridObj.endEditing,dg_pushRowData:dataGridObj.pushRowData,dg_filterItem:dataGridObj.filterItem,dg_mergeCells:dataGridObj.mergeCells,dg_getAllData:dataGridObj.getAllData,dg_getSaveItemArr:dataGridObj.getSaveItemArr,dg_getAllTablesSave:dataGridObj.getAllTablesSave,dg_checkDatagridNotNull:dataGridObj.checkDatagridNotNull,dg_eachCheckDataGrid:dataGridObj.eachCheckDataGrid,dg_dataGridResize:dataGridObj.dataGridResize,dg_dataGridOptions:dataGridObj.dataGridOptions,dg_forMergeCells:dataGridObj.forMergeCells,tg_removeTreegridNode:treeGridObj.removeTreegridNode,tg_appendTreegridNode:treeGridObj.appendTreegridNode,tg_editTreegridNode:treeGridObj.editTreegridNode,tg_updateNodeState:treeGridObj.updateNodeState,tg_treeGridResize:treeGridObj.treeGridResize}});window.yesNoFmt=function(b,a,c){return b=="1"?"是":"否"};