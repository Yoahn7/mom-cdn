layui.define("form",function(M){var I=layui.$,P=layui.form,E="tree",A={config:{},index:layui[E]?layui[E].index+10000:0,set:function(d){var c=this;return c.config=I.extend({},c.config,d),c},on:function(c,a){return layui.onevent.call(this,E,c,a)}},G=function(){var f=this,d=f.config,c=d.id||f.index;return G.that[c]=f,G.config[c]=d,{config:d,reload:function(a){f.reload.call(f,a)},getChecked:function(){return f.getChecked.call(f)},setChecked:function(a){return f.setChecked.call(f,a)}}},w="layui-hide",N="layui-disabled",x="layui-tree-set",O="layui-tree-iconClick",D="layui-icon-addition",J="layui-icon-subtraction",q="layui-tree-entry",L="layui-tree-main",B="layui-tree-txt",b="layui-tree-pack",j="layui-tree-spread",z="layui-tree-setLineShort",F="layui-tree-showLine",H="layui-tree-lineExtend",K=function(d){var c=this;c.index=++A.index,c.config=I.extend({},c.config,A.config,d),c.render()};K.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},K.prototype.reload=function(d){var c=this;layui.each(d,function(f,a){a.constructor===Array&&delete c.config[f]}),c.config=I.extend(!0,{},c.config,d),c.render()},K.prototype.render=function(){var f=this,c=f.config,g=I('<div class="layui-tree'+(c.showCheckbox?" layui-form":"")+(c.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+f.index+'"></div>');f.tree(g);var d=c.elem=I(c.elem);if(d[0]){if(c.showSearch&&g.prepend('<input type="text" class="layui-input layui-tree-search" placeholder="请输入关键字进行过滤">'),f.key=c.id||f.index,f.elem=g,f.elemNone=I('<div class="layui-tree-emptyText">'+c.text.none+"</div>"),d.html(f.elem),0==f.elem.find(".layui-tree-set").length){return f.elem.append(f.elemNone)}c.drag&&f.drag(),c.showCheckbox&&f.renderForm("checkbox"),f.elem.find(".layui-tree-set").each(function(){var a=I(this);a.parent(".layui-tree-pack")[0]||a.addClass("layui-tree-setHide"),!a.next()[0]&&a.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&a.addClass(z),a.next()[0]||a.parents(".layui-tree-set").eq(0).next()[0]||a.addClass(z)}),f.events()}},K.prototype.renderForm=function(a){P.render(a,"LAY-tree-"+this.index)},K.prototype.tree=function(g,d){var h=this,f=h.config,c=d||f.data;layui.each(c,function(i,e){var n=e.children&&e.children.length>0,m=I('<div class="layui-tree-pack" '+(e.spread?'style="display: block;"':"")+'"></div>'),k=I(['<div data-id="'+e.id+'" class="layui-tree-set'+(e.spread?" layui-tree-spread":"")+(e.checked?" layui-tree-checkedFirst":"")+'">',"<div "+(f.drag&&!e.fixed?'draggable="true"':"")+' class="layui-tree-entry">','<div class="layui-tree-main">',function(){return f.showLine?n?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(e.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(n?"":w)+'"></i></span>'}(),function(){return f.showCheckbox?'<input type="checkbox" name="layuiTreeCheck" lay-skin="primary" '+(e.disabled?"disabled":"")+'  value="'+e.id+'">':""}(),function(){return f.isJump&&e.href?'<a href="'+e.href+'" target="_blank" class="'+B+'">'+(e.title||e.label||f.text.defaultNodeName)+"</a>":'<span class="'+B+(e.disabled?" "+N:"")+'">'+(e.title||e.label||f.text.defaultNodeName)+"</span>"}(),"</div>",function(){if(!f.edit){return""}var l={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},a=['<div class="layui-btn-group layui-tree-btnGroup">'];return f.edit===!0&&(f.edit=["update","del"]),"object"==typeof f.edit?(layui.each(f.edit,function(o,p){a.push(l[p]||"")}),a.join("")+"</div>"):void 0}(),"</div></div>"].join(""));n&&(k.append(m),h.tree(m,e.children)),g.append(k),k.prev("."+x)[0]&&k.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),n||k.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),h.spread(k,e),f.showCheckbox&&h.checkClick(k,e),f.edit&&h.operate(k,e)})},K.prototype.spread=function(s,u){var f=this,c=f.config,i=s.children("."+q),v=i.children("."+L),d=i.find("."+O),h=i.find("."+B),o=c.onlyIconControl?d:v,p="";o.on("click",function(k){var g=s.children("."+b),m=o.children(".layui-icon")[0]?o.children(".layui-icon"):o.find(".layui-tree-icon").children(".layui-icon");if(g[0]){if(s.hasClass(j)){s.removeClass(j),g.slideUp(200),m.removeClass(J).addClass(D)}else{if(s.addClass(j),g.slideDown(200),m.addClass(J).removeClass(D),c.accordion){var e=s.siblings("."+x);e.removeClass(j),e.children("."+b).slideUp(200),e.find(".layui-tree-icon").children(".layui-icon").removeClass(J).addClass(D)}}}else{p="normal"}}),h.on("click",function(){var a=I(this);a.hasClass(N)||(p=s.hasClass(j)?c.onlyIconControl?"open":"close":c.onlyIconControl?"close":"open",c.click&&c.click({elem:s,state:p,data:u}))})},K.prototype.setCheckbox=function(k,g,d){var m=this,h=(m.config,d.prop("checked"));if("object"==typeof g.children||k.find("."+b)[0]){var c=k.find("."+b).find('input[name="layuiTreeCheck"]');c.each(function(){this.disabled||(this.checked=h)})}var f=function(s){if(s.parents("."+x)[0]){var r,p=s.parent("."+b),t=p.parent(),o=p.prev().find('input[name="layuiTreeCheck"]');h?o.prop("checked",h):(p.find('input[name="layuiTreeCheck"]').each(function(){this.checked&&(r=!0)}),r||o.prop("checked",!1)),f(t)}};f(k),m.renderForm("checkbox")},K.prototype.checkClick=function(h,d){var i=this,g=i.config,c=h.children("."+q),f=c.children("."+L);f.on("click",'input[name="layuiTreeCheck"]+',function(a){layui.stope(a);var e=I(this).prev(),k=e.prop("checked");e.prop("disabled")||(i.setCheckbox(h,d,e),g.oncheck&&g.oncheck({elem:h,checked:k,data:d}))})},K.prototype.operate=function(h,f){var k=this,g=k.config,c=h.children("."+q),i=c.children("."+L);c.children(".layui-tree-btnGroup").on("click",".layui-icon",function(e){layui.stope(e);var p=I(this).data("type"),o=h.children("."+b),u={data:f,type:p,elem:h};if("add"==p){o[0]||(g.showLine?(i.find("."+O).addClass("layui-tree-icon"),i.find("."+O).children(".layui-icon").addClass(D).removeClass("layui-icon-file")):i.find(".layui-tree-iconArrow").removeClass(w),h.append('<div class="layui-tree-pack"></div>'));var t=g.operate&&g.operate(u),y={};if(y.title=g.text.defaultNodeName,y.id=t,k.tree(h.children("."+b),[y]),g.showLine){if(o[0]){o.hasClass(H)||o.addClass(H),h.find("."+b).each(function(){I(this).children("."+x).last().addClass(z)}),o.children("."+x).last().prev().hasClass(z)?o.children("."+x).last().prev().removeClass(z):o.children("."+x).last().removeClass(z),!h.parent("."+b)[0]&&h.next()[0]&&o.children("."+x).last().removeClass(z)}else{var m=h.siblings("."+x),s=1,r=h.parent("."+b);layui.each(m,function(R,l){I(l).children("."+b)[0]||(s=0)}),1==s?(m.children("."+b).addClass(F),m.children("."+b).children("."+x).removeClass(z),h.children("."+b).addClass(F),r.removeClass(H),r.children("."+x).last().children("."+b).children("."+x).last().addClass(z)):h.children("."+b).children("."+x).addClass(z)}}if(!g.showCheckbox){return}if(i.find('input[name="layuiTreeCheck"]')[0].checked){var d=h.children("."+b).children("."+x).last();d.find('input[name="layuiTreeCheck"]')[0].checked=!0}k.renderForm("checkbox")}else{if("update"==p){var a=i.children("."+B).html();i.children("."+B).html(""),i.append('<input type="text" class="layui-tree-editInput">'),i.children(".layui-tree-editInput").val(a).focus();var Q=function(R){var l=R.val().trim();l=l?l:g.text.defaultNodeName,R.remove(),i.children("."+B).html(l),u.data.title=l,g.operate&&g.operate(u)};i.children(".layui-tree-editInput").blur(function(){Q(I(this))}),i.children(".layui-tree-editInput").on("keydown",function(l){13===l.keyCode&&(l.preventDefault(),Q(I(this)))})}else{if(g.operate&&g.operate(u),u.status="remove",!h.prev("."+x)[0]&&!h.next("."+x)[0]&&!h.parent("."+b)[0]){return h.remove(),void k.elem.append(k.elemNone)}if(h.siblings("."+x).children("."+q)[0]){if(g.showCheckbox){var v=function(V){if(V.parents("."+x)[0]){var S=V.siblings("."+x).children("."+q),U=V.parent("."+b).prev(),R=U.find('input[name="layuiTreeCheck"]')[0],T=1,W=0;0==R.checked&&(S.each(function(X,l){var Y=I(l).find('input[name="layuiTreeCheck"]')[0];0!=Y.checked||Y.disabled||(T=0),Y.disabled||(W=1)}),1==T&&1==W&&(R.checked=!0,k.renderForm("checkbox"),v(U.parent("."+x))))}};v(h)}if(g.showLine){var m=h.siblings("."+x),s=1,r=h.parent("."+b);layui.each(m,function(R,l){I(l).children("."+b)[0]||(s=0)}),1==s?(o[0]||(r.removeClass(H),m.children("."+b).addClass(F),m.children("."+b).children("."+x).removeClass(z)),h.next()[0]?r.children("."+x).last().children("."+b).children("."+x).last().addClass(z):h.prev().children("."+b).children("."+x).last().addClass(z),h.next()[0]||h.parents("."+x)[1]||h.parents("."+x).eq(0).next()[0]||h.prev("."+x).addClass(z)):!h.next()[0]&&h.hasClass(z)&&h.prev().addClass(z)}}else{var C=h.parent("."+b).prev();if(g.showLine){C.find("."+O).removeClass("layui-tree-icon"),C.find("."+O).children(".layui-icon").removeClass(J).addClass("layui-icon-file");var n=C.parents("."+b).eq(0);n.addClass(H),n.children("."+x).each(function(){I(this).children("."+b).children("."+x).last().addClass(z)})}else{C.find(".layui-tree-iconArrow").addClass(w)}h.parents("."+x).eq(0).removeClass(j),h.parent("."+b).remove()}h.remove()}}})},K.prototype.drag=function(){var d=this,c=d.config;d.elem.on("dragstart","."+q,function(){var a=I(this).parent("."+x),f=a.parents("."+x)[0]?a.parents("."+x).eq(0):"未找到父节点";c.dragstart&&c.dragstart(a,f)}),d.elem.on("dragend","."+q,function(Q){var Q=Q||event,u=Q.clientY,R=I(this),W=R.parent("."+x),V=W.height(),C=W.offset().top,U=d.elem.find("."+x),m=d.elem.height(),X=d.elem.offset().top,s=m+X-13,a=W.parents("."+x)[0],i=W.next()[0];if(a){var h=W.parent("."+b),y=W.parents("."+x).eq(0),v=y.parent("."+b),t=y.offset().top,k=W.siblings(),o=y.children("."+b).children("."+x).length}var e=function(p){if(a||i||d.elem.children("."+x).last().children("."+b).children("."+x).last().addClass(z),!a){return void W.removeClass("layui-tree-setHide")}if(1==o){c.showLine?(p.find("."+O).removeClass("layui-tree-icon"),p.find("."+O).children(".layui-icon").removeClass(J).addClass("layui-icon-file"),v.addClass(H),v.children("."+x).children("."+b).each(function(){I(this).children("."+x).last().addClass(z)})):p.find(".layui-tree-iconArrow").addClass(w),p.children("."+b).remove(),p.removeClass(j)}else{if(c.showLine){var g=1;layui.each(k,function(n,l){I(l).children("."+b)[0]||(g=0)}),1==g?(W.children("."+b)[0]||(h.removeClass(H),k.children("."+b).addClass(F),k.children("."+b).children("."+x).removeClass(z)),h.children("."+x).last().children("."+b).children("."+x).last().addClass(z),i||p.parents("."+x)[0]||p.next()[0]||h.children("."+x).last().addClass(z)):!i&&W.hasClass(z)&&h.children("."+x).last().addClass(z)}if(c.showCheckbox){var f=function(l){if(l){if(!l.parents("."+x)[0]){return}}else{if(!p[0]){return}}var S=l?l.siblings().children("."+q):k.children("."+q),n=l?l.parent("."+b).prev():h.prev(),Y=n.find('input[name="layuiTreeCheck"]')[0],Z=1,T=0;0==Y.checked&&(S.each(function(aa,r){var ab=I(r).find('input[name="layuiTreeCheck"]')[0];0!=ab.checked||ab.disabled||(Z=0),ab.disabled||(T=1)}),1==Z&&1==T&&(Y.checked=!0,d.renderForm("checkbox"),f(n.parent("."+x)||p)))};f()}}};U.each(function(){if(0!=I(this).height()){if(u>C&&u<C+V){return void (c.dragend&&c.dragend("drag error"))}if(1==o&&u>t&&u<C+V){return void (c.dragend&&c.dragend("drag error"))}var f=I(this).offset().top;if(u>f&&u<f+15){if(I(this).children("."+b)[0]||(c.showLine?(I(this).find("."+O).eq(0).addClass("layui-tree-icon"),I(this).find("."+O).eq(0).children(".layui-icon").addClass(D).removeClass("layui-icon-file")):I(this).find(".layui-tree-iconArrow").removeClass(w),I(this).append('<div class="layui-tree-pack"></div>')),I(this).children("."+b).append(W),e(y),c.showLine){var p=I(this).children("."+b).children("."+x);if(W.children("."+b).children("."+x).last().addClass(z),1==p.length){var S=I(this).siblings("."+x),ac=1,Y=I(this).parent("."+b);layui.each(S,function(l,g){I(g).children("."+b)[0]||(ac=0)}),1==ac?(S.children("."+b).addClass(F),S.children("."+b).children("."+x).removeClass(z),I(this).children("."+b).addClass(F),Y.removeClass(H),Y.children("."+x).last().children("."+b).children("."+x).last().addClass(z).removeClass("layui-tree-setHide")):I(this).children("."+b).children("."+x).addClass(z).removeClass("layui-tree-setHide")}else{W.prev("."+x).hasClass(z)?(W.prev("."+x).removeClass(z),W.addClass(z)):(W.removeClass("layui-tree-setLineShort layui-tree-setHide"),W.children("."+b)[0]?W.prev("."+x).children("."+b).children("."+x).last().removeClass(z):W.siblings("."+x).find("."+b).each(function(){I(this).children("."+x).last().addClass(z)})),I(this).next()[0]||W.addClass(z)}}if(c.showCheckbox&&I(this).children("."+q).find('input[name="layuiTreeCheck"]')[0].checked){var ab=W.children("."+q);ab.find('input[name="layuiTreeCheck"]+').click()}return c.dragend&&c.dragend("drag success",W,I(this)),!1}if(u<f){if(I(this).before(W),e(y),c.showLine){var aa=W.children("."+b),r=I(this).parents("."+x).eq(0),Z=r.children("."+b).children("."+x).last();if(aa[0]){W.removeClass(z),aa.children("."+x).last().removeClass(z);var S=W.siblings("."+x),ac=1;layui.each(S,function(l,g){I(g).children("."+b)[0]||(ac=0)}),1==ac?r[0]&&(S.children("."+b).addClass(F),S.children("."+b).children("."+x).removeClass(z),Z.children("."+b).children("."+x).last().addClass(z).removeClass(F)):W.children("."+b).children("."+x).last().addClass(z),!r.parent("."+b)[0]&&r.next()[0]&&Z.removeClass(z)}else{r.hasClass(H)||r.addClass(H),r.find("."+b).each(function(){I(this).children("."+x).last().addClass(z)})}r[0]||(W.addClass("layui-tree-setHide"),W.children("."+b).children("."+x).last().removeClass(z))}if(r[0]&&c.showCheckbox&&r.children("."+q).find('input[name="layuiTreeCheck"]')[0].checked){var ab=W.children("."+q);ab.find('input[name="layuiTreeCheck"]+').click()}return c.dragend&&c.dragend("拖拽成功，插入目标节点上方",W,I(this)),!1}if(u>s){return d.elem.children("."+x).last().children("."+b).addClass(F),d.elem.append(W),e(y),W.prev().children("."+b).children("."+x).last().removeClass(z),W.addClass("layui-tree-setHide"),W.children("."+b).children("."+x).last().addClass(z),c.dragend&&c.dragend("拖拽成功，插入最外层节点",W,d.elem),!1}}})})},K.prototype.events=function(){var d=this,c=d.config,f=d.elem.find(".layui-tree-checkedFirst");layui.each(f,function(h,g){I(g).children("."+q).find('input[name="layuiTreeCheck"]+').trigger("click")}),d.elem.find(".layui-tree-search").on("keyup",function(){var h=I(this),e=h.val(),a=h.nextAll(),g=[];a.find("."+B).each(function(){var k=I(this).parents("."+q);if(I(this).html().indexOf(e)!=-1){g.push(I(this).parent());var i=function(l){l.addClass("layui-tree-searchShow"),l.parent("."+b)[0]&&i(l.parent("."+b).parent("."+x))};i(k.parent("."+x))}}),a.find("."+q).each(function(){var i=I(this).parent("."+x);i.hasClass("layui-tree-searchShow")||i.addClass(w)}),0==a.find(".layui-tree-searchShow").length&&d.elem.append(d.elemNone),c.onsearch&&c.onsearch({elem:g})}),d.elem.find(".layui-tree-search").on("keydown",function(){I(this).nextAll().find("."+q).each(function(){var a=I(this).parent("."+x);a.removeClass("layui-tree-searchShow "+w)}),I(".layui-tree-emptyText")[0]&&I(".layui-tree-emptyText").remove()})},K.prototype.getChecked=function(){var g=this,d=g.config,h=[],f=[];g.elem.find(".layui-form-checked").each(function(){h.push(I(this).prev()[0].value)});var c=function(k,i){layui.each(k,function(l,a){layui.each(h,function(o,p){if(a.id==p){var m=I.extend({},a);return delete m.children,i.push(m),a.children&&(m.children=[],c(a.children,m.children)),!0}})})};return c(I.extend({},d.data),f),f},K.prototype.setChecked=function(d){var c=this;c.config;c.elem.find("."+x).each(function(f,i){var h=I(this).data("id"),e=I(i).children("."+q).find('input[name="layuiTreeCheck"]'),g=e.next();if("number"==typeof d){if(h==d){return e[0].checked||g.click(),!1}}else{I.inArray(h,d)!=-1&&(e[0].checked||g.click())}})},G.that={},G.config={},A.reload=function(f,d){var c=G.that[f];return c.reload(d),G.call(c)},A.getChecked=function(c){var a=G.that[c];return a.getChecked()},A.setChecked=function(f,d){var c=G.that[f];return c.setChecked(d)},A.render=function(c){var a=new K(c);return G.call(a)},M(E,A)});