layui.define("layer",function(q){var y=layui.$,k=layui.layer,h=layui.hint(),w=layui.device(),g={config:{},set:function(c){var a=this;return a.config=y.extend({},a.config,c),a},on:function(c,a){return layui.onevent.call(this,b,c,a)}},j=function(){var a=this;return{upload:function(c){a.upload.call(a,c)},reload:function(c){a.reload.call(a,c)},config:a.config}},b="upload",x="layui-upload-file",v="layui-upload-form",m="layui-upload-iframe",z="layui-upload-choose",d=function(c){var a=this;a.config=y.extend({},a.config,g.config,c),a.render()};d.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},d.prototype.render=function(c){var a=this,c=a.config;c.elem=y(c.elem),c.bindAction=y(c.bindAction),a.file(),a.events()},d.prototype.file=function(){var c=this,a=c.config,l=c.elemFile=y(['<input class="'+x+'" type="file" accept="'+a.acceptMime+'" name="'+a.field+'"',a.multiple?" multiple":"",">"].join("")),f=a.elem.next();(f.hasClass(x)||f.hasClass(v))&&f.remove(),w.ie&&w.ie<10&&a.elem.wrap('<div class="layui-upload-wrap"></div>'),c.isFile()?(c.elemFile=a.elem,a.field=a.elem[0].name):a.elem.after(l),w.ie&&w.ie<10&&c.initIE()},d.prototype.initIE=function(){var l=this,f=l.config,o=y('<iframe id="'+m+'" class="'+m+'" name="'+m+'" frameborder="0"></iframe>'),c=y(['<form target="'+m+'" class="'+v+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+f.url+'">',"</form>"].join(""));y("#"+m)[0]||y("body").append(o),f.elem.next().hasClass(v)||(l.elemFile.wrap(c),f.elem.next("."+v).append(function(){var a=[];return layui.each(f.data,function(n,e){e="function"==typeof e?e():e,a.push('<input type="hidden" name="'+n+'" value="'+e+'">')}),a.join("")}()))},d.prototype.msg=function(a){return k.msg(a,{icon:2,shift:6})},d.prototype.isFile=function(){var a=this.config.elem[0];if(a){return"input"===a.tagName.toLocaleLowerCase()&&"file"===a.type}},d.prototype.preview=function(c){var a=this;window.FileReader&&layui.each(a.chooseFiles,function(f,e){var l=new FileReader;l.readAsDataURL(e),l.onload=function(){c&&c(f,e,this.result)}})},d.prototype.upload=function(D,A){var p,f=this,t=f.config,a=f.elemFile[0],J=function(){var l=0,o=0,c=D||f.files||f.chooseFiles||a.files,e=function(){t.multiple&&l+o===f.fileLength&&"function"==typeof t.allDone&&t.allDone({total:f.fileLength,successful:l,aborted:o})};layui.each(c,function(u,i){var n=new FormData;n.append(t.field,i),layui.each(t.data,function(F,r){r="function"==typeof r?r():r,n.append(F,r)}),y.ajax({url:t.url,type:"post",data:n,contentType:!1,processData:!1,dataType:"json",headers:t.headers||{},success:function(r){l++,E(u,r),e()},error:function(){o++,f.msg("请求上传接口出现异常"),s(u),e()}})})},G=function(){var c=y("#"+m);f.elemFile.parent().submit(),clearInterval(d.timer),d.timer=setInterval(function(){var l,e=c.contents().find("body");try{l=e.text()}catch(o){f.msg("获取上传后的响应信息出现异常"),clearInterval(d.timer),s()}l&&(clearInterval(d.timer),e.html(""),E(0,l))},30)},E=function(n,l){if(f.elemFile.next("."+z).remove(),a.value="","object"!=typeof l){try{l=JSON.parse(l)}catch(c){return l={},f.msg("请对上传接口返回有效JSON")}}"function"==typeof t.done&&t.done(l,n||0,function(i){f.upload(i)})},s=function(c){t.auto&&(a.value=""),"function"==typeof t.error&&t.error(c||0,function(i){f.upload(i)})},B=t.exts,I=function(){var c=[];return layui.each(D||f.chooseFiles,function(n,l){c.push(l.name)}),c}(),C={preview:function(c){f.preview(c)},upload:function(n,l){var c={};c[n]=l,f.upload(c)},pushFile:function(){return f.files=f.files||{},layui.each(f.chooseFiles,function(i,c){f.files[i]=c}),f.files},resetFile:function(o,l,c){var r=new File([l],c);f.files=f.files||{},f.files[o]=r}},H=function(){if("choose"!==A&&!t.auto||(t.choose&&t.choose(C),"choose"!==A)){return t.before&&t.before(C),w.ie?w.ie>9?J():G():void J()}};if(I=0===I.length?a.value.match(/[^\/\\]+\..+/g)||[]||"":I,0!==I.length){switch(t.accept){case"file":if(B&&!RegExp("\\w\\.("+B+")$","i").test(escape(I))){return f.msg("选择的文件中包含不支持的格式"),a.value=""}break;case"video":if(!RegExp("\\w\\.("+(B||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(I))){return f.msg("选择的视频中包含不支持的格式"),a.value=""}break;case"audio":if(!RegExp("\\w\\.("+(B||"mp3|wav|mid")+")$","i").test(escape(I))){return f.msg("选择的音频中包含不支持的格式"),a.value=""}break;default:if(layui.each(I,function(i,c){RegExp("\\w\\.("+(B||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(c))||(p=!0)}),p){return f.msg("选择的图片中包含不支持的格式"),a.value=""}}if(f.fileLength=function(){var e=0,c=D||f.files||f.chooseFiles||a.files;return layui.each(c,function(){e++}),e}(),t.number&&f.fileLength>t.number){return f.msg("同时最多只能上传的数量为："+t.number)}if(t.size>0&&!(w.ie&&w.ie<10)){var K;if(layui.each(f.chooseFiles,function(n,l){if(l.size>1024*t.size){var c=t.size/1024;c=c>=1?c.toFixed(2)+"MB":t.size+"KB",a.value="",K=c}}),K){return f.msg("文件不能超过"+K)}}H()}},d.prototype.reload=function(c){c=c||{},delete c.elem,delete c.bindAction;var a=this,c=a.config=y.extend({},a.config,g.config,c),f=c.elem.next();f.attr({name:c.name,accept:c.acceptMime,multiple:c.multiple})},d.prototype.events=function(){var f=this,c=f.config,n=function(e){f.chooseFiles={},layui.each(e,function(o,l){var p=(new Date).getTime();f.chooseFiles[p+"-"+o]=l})},a=function(i,p){var e=f.elemFile,l=i.length>1?i.length+"个文件":(i[0]||{}).name||e[0].value.match(/[^\/\\]+\..+/g)||[]||"";e.next().hasClass(z)&&e.next().remove(),f.upload(null,"choose"),f.isFile()||c.choose||e.after('<span class="layui-inline '+z+'">'+l+"</span>")};c.elem.off("upload.start").on("upload.start",function(){var i=y(this),p=i.attr("lay-data");if(p){try{p=new Function("return "+p)(),f.config=y.extend({},c,p)}catch(e){h.error("Upload element property lay-data configuration item has a syntax error: "+p)}}f.config.item=i,f.elemFile[0].click()}),w.ie&&w.ie<10||c.elem.off("upload.over").on("upload.over",function(){var i=y(this);i.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var i=y(this);i.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(o,e){var l=y(this),i=e.originalEvent.dataTransfer.files||[];l.removeAttr("lay-over"),n(i),c.auto?f.upload(i):a(i)}),f.elemFile.off("upload.change").on("upload.change",function(){var e=this.files||[];n(e),c.auto?f.upload():a(e)}),c.bindAction.off("upload.action").on("upload.action",function(){f.upload()}),c.elem.data("haveEvents")||(f.elemFile.on("change",function(){y(this).trigger("upload.change")}),c.elem.on("click",function(){f.isFile()||y(this).trigger("upload.start")}),c.drag&&c.elem.on("dragover",function(i){i.preventDefault(),y(this).trigger("upload.over")}).on("dragleave",function(i){y(this).trigger("upload.leave")}).on("drop",function(i){i.preventDefault(),y(this).trigger("upload.drop",i)}),c.bindAction.on("click",function(){y(this).trigger("upload.action")}),c.elem.data("haveEvents",!0))},g.render=function(c){var a=new d(c);return j.call(a)},q(b,g)});