define(function(require){function e(e,t){if(e){var a,n,l,d=e.selector,s=[];function o(){t.initFilterSelect instanceof Array?s=t.initFilterSelect||[]:t.initFilterSelect instanceof Object&&(s=t.initFilterSelect.debarColumns||[],l=$.trim(t.initFilterSelect.bindDom)||""),t.fixedColumns&&(a=t.fixedColumns.leftColumns||0,n=t.fixedColumns.rightColumns||0);var e=$(d).find("thead").find("th"),i=e.find("input.i-checks");if(i){var o=i.index();-1==s.indexOf(o)&&s.push(e.index())}if(0==t.filSelIncludeFixCol){for(var c=[],f=0;f<a;f++)c.push(f);for(var u=1;u<=n;u++)c.push(e.length-u);concatArr=s.concat(c),$(concatArr).each(function(e,t){-1==s.indexOf(t)&&s.push(t)})}r()}function r(){var e="",t=$(d).find("thead").find("th");t.length-s.length==1?e+=' <li  class="toggle-vis" data-column="'+i+'"><label><input type="checkbox"  class="i-checks aa" checked disabled="disabled" />'+$(d).find("thead").find("th").eq(i).text()+"</label></li>":$(t).each(function(t,a){-1==s.indexOf(t)&&(e+=' <li  class="toggle-vis" data-column="'+t+'"><label><input type="checkbox"  class="i-checks" checked />'+$(d).find("thead").find("th").eq(t).text()+"</label></li>")}),c(e)}function c(e){var t=$(d).closest(".dataTable-item");if(null!=l&&""!=l||(l=".tableSelect"),"header"!=l&&$(l).length>0)$(l).html(e);else{var a=$('<ul class="tableSelect"></ul>').html(e);a.prependTo($(t)),$(".tableSelect").click(function(e){window.event?window.event.cancelBubble=!0:e.stopPropagation(),window.event?window.event.returnValue:e.preventDefault()}),$("body").click(function(){var e=$(".tableSelect").css("display");"none"!==e&&$(".tableSelect").fadeOut("500")})}renderIChecks()}o(),$(l).find("li").on("ifClicked","input.i-checks:first",function(t){$(this).prop("checked")?$(this).prop("checked",!1):$(this).prop("checked",!0);var a=$(l).find("input.i-checks:checked").length,n=$(this).closest(".tableSelect").find("input.i-checks");e.fnSetColumnVis($(this).closest("li").attr("data-column"),$(this).prop("checked"),!0),a>1?$.each(n,function(e,t){$(t).hasClass("aa")&&$(t).iCheck("enable")}):$.each(n,function(e,t){$(t).is(":checked")&&$(t).iCheck("disable").addClass("aa")})}),$(d).find("thead th").each(function(e,t){$(t)[0].oncontextmenu=function(e){var t=e||window.event,a=document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.scrollTop||document.body.scrollTop,i=t.pageX||t.clientX+a,l=t.pageY||t.clientY+n;return $(".tableSelect").fadeIn("500").css({top:l,left:i}),!1}})}}function t(e,t){$(e).dataTable().fnDraw();try{dt=$(e).dataTable(t),$(window).resize(function(){dt.api().columns.adjust().draw()}),renderSelect2(),renderIChecks()}catch(e){console.error(e),Mom.layAlert("表格数据渲染异常，请检查")}return dt}require("js/plugins/datatables/js/jquery.dataTables.min");var a=[cdnDomain+"/js/plugins/datatables/css/jquery.dataTables.min.css",cdnDomain+"/js/plugins/datatables/css/dataTables_my.css"];$.each(a,function(e,t){document.getElementsByTagName("head")[0];var a=document.createElement("link");a.href=t,a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),$(a).insertBefore("title")}),$.fn.dataTable&&($.fn.dataTable.defaults.bSort=!0,$.fn.dataTable.defaults.order=[],$.fn.dataTable.defaults.paging=!1,$.fn.dataTable.defaults.bPaginate=!1,$.fn.dataTable.defaults.pagingType="full_numbers",$.fn.dataTable.defaults.info=!1,$.fn.dataTable.defaults.bAutoWidth=!1,$.fn.dataTable.defaults.bDestroy=!0,$.fn.dataTable.defaults.bProcessing=!0,$.fn.dataTable.defaults.searching=!1,$.fn.dataTable.defaults.bFilter=!1,$.fn.dataTable.defaults.colReorder=!1,$.fn.dataTable.defaults.oLanguage={sProcessing:"处理中...",sLengthMenu:"每页显示 _MENU_ 条记录",sZeroRecords:"没有找到符合条件的数据",sInfo:"显示第 _START_ ~ _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"没有数据",sInfoFiltered:"(从 _MAX_ 条数据中检索)",sInfoPostFix:"",sUrl:"",sSearch:"搜索：",sSearchPlaceholder:"关键字筛选",sEmptyTable:"没有找到符合条件的数据",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}}),$.extend(!0,$.fn.DataTable,{addRows3:function(e,t){var a=this;if(null!=t)for(var n=e.length-1;n>-1;n--){a.row.add(e[n]);var i=a.fnSettings().aiDisplay,l=i.pop();i.splice(t,0,l)}else a.rows.add(e);return a.draw(!1)}}),window.dt_addRows=function(e,t,a){dt=a||dt;var n=dt.api();if(null!=t)for(var i=dt.fnSettings().aiDisplayMaster,l=e.length-1;l>-1;l--){n.row.add(e[l]);var d=i.pop();i.splice(t,0,d)}else n.rows.add(e);return n.draw(!1),$.fn.iCheck&&renderIChecks(),$.fn.select2&&renderSelect2($(".select2")),n.rows()},window.dt_hideCols=function(e,t,a){dt=a||dt;for(var n=dt.api(),i=0;i<e.length;i++)n.column(e[i]).visible(!1,!1);t=null!=t,n.columns.adjust().draw(t)},window.dt_getCheckRows=function(e){var t=[],a=$(e).closest(".dataTables_wrapper"),n=($(a).find(".dataTables_scrollHead"),$(a).find(".dataTables_scrollBody tbody")),i=($(a).find(".DTFC_LeftHeadWrapper"),$(a).find(".DTFC_LeftBodyWrapper tbody"));if(n.length){var l=i.length>0?i:n,d=$(l).find("input.i-checks");$.each(d,function(e,a){if($(a).is(":checked")){var n=$(a).attr("id");t.push({id:n||"",rownum:e})}})}else $(e).find("tr td input.i-checks:checkbox").each(function(e,a){if($(this).is(":checked")){var n=$(this).attr("id");t.push({id:n||"",rownum:e})}});return t},window.dt_deleteRows=function(e,t,a){var n=Mom.top(),i=dt_getCheckRows(e);i.length?Mom.layConfirm("请您确认是否要删除勾选数据?",function(l){var d=$(e).closest(".dataTables_wrapper"),s=$(d).find(".dataTables_scrollBody tbody"),o=$(d).find(".dataTables_scrollHead"),r=$(d).find(".DTFC_LeftHeadWrapper"),c=$(d).find(".DTFC_LeftBodyWrapper tbody");s&&s.length||(o=$(e).find("thead"),s=$(e).find("tbody"));var f=[],u=[];if($.each(i,function(e,t){u.push(t.rownum),""!=t.id&&t.id>0&&f.push(t.id)}),f.length){var h={ids:f.join(",")};Api.ajaxForm(t,h,function(t){if(1==t.success){var d=$(e).closest(".dataTable-item").find("span.count");$(d).text(parseInt(d)-f.length),a?a(t,l,o,s,i,c):($(o).find("input").iCheck("uncheck"),r&&$(r).find("input").iCheck("uncheck"),c&&$(c).find("input").iCheck("uncheck"),$.each(s.find("tr"),function(e,t){u.contains(e)&&($(t).remove(),c&&c.find("tr").eq(e).remove())}),n.layer.close(l))}else Mom.layMsg(t.message)})}else $.each(s.find("tr"),function(e,t){u.contains(e)&&$(t).remove()}),n.layer.close(l)}):Mom.layMsg("请选择至少一条数据！")},$.fn.dt_renderData=function(a){var n="#"+$(this).attr("id");if($(n).length){if("auto"==a.scrollY){var i=1==$(n+"_wrapper").length?$(n+"_wrapper"):$(n),l=i.find(".dataTables_scrollHead").find("thead").outerHeight()||i.find("thead").outerHeight()||0,d=i.next("div.pagination-box").outerHeight(!0)||0;$(window).outerHeight()>0&&(a.scrollY=$(window).outerHeight()-Math.ceil(i.offset().top)-l-d-20,a.scrollX=!0,a.scrollCollapse=!0)}var s=[];if(a.colReorder&&s.push("dataTable_colReorder"),a.fixedHeader&&s.push("dataTable_fixedHeader"),a.fixedColumns){s.push("dataTable_fixedColumns");var o=a.fixedColumns.leftColumns||0,r=a.fixedColumns.rightColumns||0;if(a.colReorder){var c=a.colReorder.fixedColumnsLeft||0;c<o&&(c=o);var f=a.colReorder.fixedColumnsRight||0;f<r&&(f=r),"object"==typeof a.colReorder?(a.colReorder.fixedColumnsLeft=c,a.colReorder.fixedColumnsRight=f):a.colReorder={fixedColumnsLeft:c,fixedColumnsRight:f}}}if(a.colResizable&&s.push("dataTable_colResizable"),!s.length)return dt=t(n,a),a.initFilterSelect&&e(dt,a),dt;require(s,function(){return dt=t(n,a),a.colResizable&&$(n).colResizable({liveDrag:!0,gripInnerHtml:"<div class='grip'></div>",draggingClass:"dragging",resizeMode:"flex"}),a.initFilterSelect&&e(dt,a),dt})}},window.dt_getData=function(e){var t=[];return $(e).find("tbody tr").each(function(e,a){var n=$(a).serializeJSON();delete n[""],t.push(n)}),t}});