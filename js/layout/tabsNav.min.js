var TabsNav=function(){function t(t,e,i){t=t||Const.admin+"/api/sys/SysMenu/getCurrentUserMenu/sysmenu",e=e||{},Api.ajaxForm(t,e,function(t){if(t.success)if(t.children.length>0){g.menuList=t.children,i&&i(g.menuList);var e=g.menuList[0].children,n=a(e,1);$("#side-menu").html(n),r(),l()}else alert("您没有菜单权限，即将返回登录页"),location.href="../login.html";else Mom.layAlert(t.message)})}function a(t,a){if(a>=8)return"";for(var i="",n=0;t&&n<t.length;n++)i+=e(t[n],a);return i}function e(t,e){var i=[],n=t.children&&t.children.length,s="";if(t.href&&(s+=' target="'+(t.target||"")+'"'),n&&(s+=' data-toggle="collapse" data-target="p'+t.id+'" '),1==e){if(i=['<li style="background: none repeat scroll 0 0 rgba(0, 0, 0, '+I+');">',"<a "+s+' href="'+(t.href?$.trim(t.href):"javascript:;")+'" class="title-menu-left '+(t.href?"navItem-tit":"")+'">','<span title="'+t.name+'">'+(t.name||" ")+"</span>",'<i class="pull-right config-wrap '+(t.icon?t.icon:"fa icon-arrow-right")+'"></i>',"</a>"],n){var r=a(t.children,e+1);i.push('<ul id="p'+t.id+'" class="collapse nav-level'+(e+1)+'">'+r+"</ul>")}i.push("</li>")}else{var l=t.icon?t.icon:"hidden",o=e>2?"background: none repeat scroll 0 0 rgba(0, 0, 0, "+Number(I).Add(.05*(e-2))+");":"";if(i=['<li style="'+o+'">',"<a "+s+' href="'+(t.href?$.trim(t.href):"javascript:;")+'" class=" '+(t.href?"navItem-tit":"")+'">','<i class="'+l+'"></i>','<span title="'+t.name+'">'+(t.name||" ")+"</span>",n?'<h4><img class="secRightIco" src="'+b+'/images/plus.png"></h4>':"","</a>"],n){r=a(t.children,e+1);i.push('<ul id="p'+t.id+'" class="collapse nav-level'+(e+1)+'">'+r+"</ul>")}i.push("</li>")}return i.join("")}function i(t){var a=$(t).children("span");$(t).closest("li").animate({margin:"10px 0"},"fast",function(){$(this).addClass("active")}),$(a).css({opacity:"0",top:"20px",left:"20px","font-size":"12px"}),$(a).animate({opacity:1,top:0,left:"10px"},"slow",function(){$(a).addClass("light")})}function n(t){var a=$(t).children("span");$(t).closest("li").animate({margin:0},"fast",function(){$(this).removeClass("active")}),$(a).css("font-size","14px").removeClass("light")}function s(){function t(a,e){for(var i=[],n=0;e&&n<e.length;n++){var s=e[n];if(s.children&&s.children.length){var r=t(a,s.children),l=$.extend({},s,{children:r});r&&r.length&&i.push(l)}else s.name.indexOf(a)>-1&&s.href&&i.push(s)}return i}$("#side-menu").empty();var e=[];if(g.menuList.length){var i=$(this).parent().find(".search-input").val();if(e=i?t(i,g.menuList):g.menuList,e.length){var n=e[0].children,s=a(n,1);if($("#side-menu").append(s),l(),i){var r=$("#side-menu li a.navItem-tit");r.length&&r.eq(0).trigger("click")}}else $("#side-menu").append("<p class='nodata'>未找到数据</p>")}}function r(){$(".search-group .search-input").keydown(function(t){13==t.keyCode&&s()}),$(".search-group .search-btn").click(function(){s()}),$("#side-menu").on("click","a[data-toggle='collapse']",function(t){$(this).siblings("ul.collapse").collapse("toggle")}),$("#side-menu").on("click",".navItem-tit",function(t){t.preventDefault();var a=$(this).attr("href"),e=$.trim($(this).text()),i=$(this).attr("target")||"mainFrame";if($(".navItem-tit").removeClass("active"),$(this).addClass("active"),a){if("mainFrame"==i)return p(e,a);if("_blank"==i.toLowerCase())return window.open(Mom.resolveUrl(a));"hideFrame"==i&&$("#hideFrame").attr("src",Mom.resolveUrl(a))}}),$(".tabs-nav").on("click",".navItem-tabTag",function(){if(!$(this).hasClass("active")){var t=$(this).data("id");$(this).index();o(t),$(this).addClass("active").siblings(".navItem-tabTag").removeClass("active"),d(this)}}),$(".tabs-nav").on("dblclick",".navItem-tabTag",function(){var t=$('.J_iframe[data-id="'+$(this).data("id")+'"]');u(t)}),$(".tabs-nav").on("click",".navItem-tabTag>i",function(){m($(this).parents(".navItem-tabTag"))}),$(".tabs-lBtn").on("click",h),$(".tabs-rBtn").on("click",f),$(".tabTag-closeOther").on("click",function(){$(".tabs-nav").children("[data-id]").not(":first").not(".active").each(function(){$('.J_iframe[data-id="'+$(this).data("id")+'"]').remove(),$(this).remove()}),$(".tabs-nav").css("margin-left","0")}),$(".tabTag-fixed").on("click",function(){d($(".navItem-tabTag.active"))}),$(".tabTag-closeAll").on("click",function(){$(".tabs-nav").children("[data-id]").not(":first").each(function(){$('.J_iframe[data-id="'+$(this).data("id")+'"]').remove(),$(this).remove()}),$(".tabs-nav").children("[data-id]:first").each(function(){$('.J_iframe[data-id="'+$(this).data("id")+'"]').removeClass("fadeOut").addClass("fadeInRight"),$(this).addClass("active")}),$(".tabs-nav").css("margin-left","0")}),$.fn.slimScroll&&$("#tree-wrap").slimScroll({height:"100%"})}function l(){$("#side-menu ul.collapse").on("show.bs.collapse",function(t){t.stopPropagation();var a=$(this).siblings("a");a.hasClass("title-menu-left")?i(a):a.find(".secRightIco").prop("src",b+"/images/minus.png")}),$("#side-menu ul.collapse").on("hide.bs.collapse",function(t){t.stopPropagation();var a=$(this).siblings("a");a.hasClass("title-menu-left")?n(a):a.find(".secRightIco").prop("src",b+"/images/plus.png")}),$(".navItem-tit").each(function(t){$(this).attr("data-index")||$(this).attr("data-index",t+1)})}function o(t){$(".wrap-con .J_iframe").addClass("fadeOut").removeClass("fadeInRight"),$(".wrap-con .J_iframe").each(function(){if($(this).data("id")==t)return $(this).removeClass("fadeOut").addClass("fadeInRight"),!1})}function c(t){var a=0;return $(t).each(function(){a+=$(this).outerWidth(!0)}),a}function d(t){var a=c($(t).prevAll()),e=c($(t).nextAll()),i=c($(".content-tabs").children().not(".tabs-menu")),n=$(".content-tabs").outerWidth(!0)-i,s=0;if($(".tabs-nav").outerWidth()<n)s=0;else if(e<=n-$(t).outerWidth(!0)-$(t).next().outerWidth(!0)){if(n-$(t).next().outerWidth(!0)>e){s=a;for(var r=t;s-$(r).outerWidth()>$(".tabs-nav").outerWidth()-n;)s-=$(r).prev().outerWidth(),r=$(r).prev()}}else a>n-$(t).outerWidth(!0)-$(t).prev().outerWidth(!0)&&(s=a-$(t).prev().outerWidth(!0));$(".tabs-nav").animate({marginLeft:0-s+"px"},"fast")}function h(){var t=Math.abs(parseInt($(".tabs-nav").css("margin-left"))),a=c($(".content-tabs").children().not(".tabs-menu")),e=$(".content-tabs").outerWidth(!0)-a,i=0;if($(".tabs-nav").width()<e)return!1;for(var n=$(".navItem-tabTag:first"),s=0;s+$(n).outerWidth(!0)<=t;)s+=$(n).outerWidth(!0),n=$(n).next();if(s=0,c($(n).prevAll())>e){for(;s+$(n).outerWidth(!0)<e&&n.length>0;)s+=$(n).outerWidth(!0),n=$(n).prev();i=c($(n).prevAll())}$(".tabs-nav").animate({marginLeft:-i+"px"},"fast")}function f(){var t=Math.abs(parseInt($(".tabs-nav").css("margin-left"))),a=c($(".content-tabs").children().not(".tabs-menu")),e=$(".content-tabs").outerWidth(!0)-a,i=0;if($(".tabs-nav").width()<e)return!1;for(var n=$(".navItem-tabTag:first"),s=0;s+$(n).outerWidth(!0)<=t;)s+=$(n).outerWidth(!0),n=$(n).next();for(s=0;s+$(n).outerWidth(!0)<e&&n.length>0;)s+=$(n).outerWidth(!0),n=$(n).next();i=c($(n).prevAll()),i>0&&$(".tabs-nav").animate({marginLeft:-i+"px"},"fast")}function v(){var t=$(".J_iframe.fadeInRight")||$(".J_iframe:visible");return t.eq(t.length-1)}function u(t){if(Mom.crossOrigin)location.href=location.href;else{t&&0!=t.length||(t=this.getActiveTab()),$(t).trigger("dblclick");var a=t.attr("src"),e=layer.load();t.attr("src",a).load(function(){layer.close(e)})}}function m(t){function a(t,a){a.remove(),$(".wrap-con .J_iframe").each(function(){if($(this).data("id")==t)return $(this).remove(),!1})}if(!Mom.crossOrigin){t||(t=$(".navItem-tabTag.active"));var e=t.data("id"),i=t.width();if(t.hasClass("active")){var n=t.next(".navItem-tabTag"),s=t.prev(".navItem-tabTag");if(n.length){var r=n.data("id");n.addClass("active"),o(r),a(e,t);var l=parseInt($(".tabs-nav").css("margin-left"));return l<0&&$(".tabs-nav").animate({marginLeft:l+i+"px"},"fast"),!1}if(s.length){r=s.data("id");s.addClass("active"),o(r),a(e,t)}}else a(e,t),d($(".navItem-tabTag.active"));return!1}self.close()}function p(t,a,e){if(!Mom.crossOrigin){a=Mom.resolveUrl(a);e=1==e&&e;var i=t,n=!0;if(null==a||0==$.trim(a).length)return!1;if(e||$(".navItem-tabTag").each(function(){if($(this).data("id")==a)return $(this).hasClass("active")||($(this).addClass("active").siblings(".navItem-tabTag").removeClass("active"),d($(this)),o(a)),n=!1,!1}),e||n){var s='<a href="javascript:;" class="active navItem-tabTag" data-id="'+a+'">'+i+' <i class="fa fa-times-circle"></i></a>';top.$(".navItem-tabTag").removeClass("active");var r='<iframe class="J_iframe animated fadeInRight" width="100%" height="100%" src="'+a+'" frameborder="0" data-id="'+a+'"></iframe>';top.$(".wrap-con").find("iframe.J_iframe").addClass("fadeOut").removeClass("fadeInRight"),top.$(".wrap-con").append($(r));var l=layer.load();top.$(".wrap-con iframe:visible").load(function(){layer.close(l)}),top.$(".tabs-menu .tabs-nav").append(s),d(top.$(".navItem-tabTag.active"))}return!1}e?window.open(a):location.href=a}var g=this,b=window.baseStatic,I=.1;return{menuInit:t,getActiveTab:v,refreshTab:u,openTab:p,closeTab:m}}();