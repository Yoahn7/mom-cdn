var Api=window.Api||function(){var e,o,n=!1,a=0;jQuery.support.cors=!0;var t=function(e,o,n,a,t,r){var c={url:e,data:o||"{}",contentType:"Json",checkUser:t};s(c,n,a,r)},r=function(e,o,n,a,t,r){var c={url:e,data:o||{},contentType:"Form",checkUser:t};s(c,n,a,r)},s=function(e,n,a,t){var r=e.url,s=e.data,c=e.contentType,l=Mom.getAuthInfo(),u=Mom.top(),p=Mom.getUrlParam("__noauth",r);if(p&&(e.checkUser="false"==p),(null==e.checkUser||1==e.checkUser)&&""==l){var d="checkAlert_"+u.location.href.substr(u.location.href.lastIndexOf("/")+1),m=Mom.getCookie(d)||"";return""==m&&(m=0),0===m?(Mom.setCookie(d,m+1),alert("未登录或登录超时。请重新登录，谢谢！")):console.error("token已失效!"),void(Mom.top().location.href=Mom.basePath+"/login.html")}r&&r.length>0&&(r=Mom.resolveUrl(r));var f=Mom.getAuthInfo("loginName");if("demo1"==f)for(var y=["delete","save","resetPassword","updatePassword","addTempDetail","delTempDetail","ajaxSaveDist","addUser","saveGroupTile","ajaxSave","del/","addApp"],h=0;h<y.length;h++)if(r.indexOf(y[h])>-1)return Mom.layMsg("演示账号，禁止操作！"),!1;o?i({headers:{Authorization:l},url:r,data:s,contentType:c,async:e.async},n,a,t):require([cdnDomain+"/js/plugins/crypto/crypto-my.min.js"],function(u){o=u,i({headers:{Authorization:l},url:r,data:s,contentType:c,async:e.async},n,a,t)})},c=function(e,o,n,a,t){o&&r(Const.admin+"/api/sys/WebapiInfo/call/"+e+"/"+o,n,a,t,!1)},i=function(t,r,s,c){function i(){c&&(a--,e&&0==a&&p.layer.close(e))}var l="post",u=t.url||"";if(u.toLowerCase().endWith("\\.json")&&(l="get"),n&&console.log("发起ajaxForm请求：",u,"参数：",data),null==c&&(c=!0),c){var p=Mom.top();e=p.layer.load(1),a++}var d=$.extend(!0,{},{headers:{Accept:"application/json; charset=utf-8",Sign:o.encrypt(Math.random().toString(36).substring(2)+"."+Mom.getAuthInfo("id")+"."+Date.now())},url:u,dataType:"json",type:l,crossDomain:!0,async:null==t.async||1==t.async,success:function(e){n&&console.log("返回：",e),i(),e.success,r&&r(e)},complete:function(e,o){},error:function(e){console.error(e),i(),s?s(e):Mom.layMsg("请求服务器异常."+(e.responseText||""))}},t),m=d.contentType||"Json";"Json"==m?m="application/json":"Form"==m&&(m="application/x-www-form-urlencoded"),d.contentType=m,$.ajax(d)};return{ajaxJson:t,ajaxForm:r,ajaxAdvance:s,webApi:c}}();