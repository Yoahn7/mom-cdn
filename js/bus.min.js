var Bus=window.Bus||function(){function delCheckTable(e,t,n,o){var i=[];if($(n+" tbody tr").each(function(e,t){var n=$(t).find("td:first input.i-checks");if(n&&1==n.is(":checked")){var o=n.attr("id")||n.val();i.push(o)}}),i.length>0){var a={ids:i.join(",")};postFormConfirm(e,t,a,o)}else Mom.layMsg("请至少选择一条数据")}function postCheckData(e,t,n,o){var i=[];if($(n+" tbody tr").each(function(e,t){var n=$(t).find("td:first input.i-checks");if(n&&1==n.is(":checked")){var o=n.attr("id")||n.val();i.push(o)}}),i.length>0){var a=$.extend(!0,{},{ids:i.join(",")},t.data);postFormConfirm(e,t.url,a,o)}else Mom.layMsg("请至少选择一条数据!")}function createSelect(e,t,n,o,i){$(t).empty();var a="- 请选择 -";"string"==typeof i&&(a=i),$(t).append('<option value="">'+a+"</option>"),Api.ajaxJson(e,"{}",function(e){if(e.success){var a=e.rows;appendOptionsValue($(t),a,n,o),"function"==typeof i&&i($(t),a)}else Mom.layAlert(e.message)})}function resetSelect(e,t){$(e).empty(),t=t||"-- 全部 --",$(e).append("<option value=''>"+t+"</option>")}function appendOptionsValue(e,t,n,o){if("string"==typeof e&&(e=$(e)),t&&t.length>0){var i=new Array;n=n||"value",o=o||"label",$(t).each(function(e,t){i.push({value:t[n],label:t[o]})}),appendOptions(e,i)}}function appendOptions(e,t){t&&$(t).each(function(t,n){$(e).append("<option value='"+n.value+"'>"+n.label+"</option>")})}function getOperPermit(authClassCode){$(".privileges").length?Api.ajaxForm(Const.admin+"/api/imp/sys/UserPermission/currentUserElements/"+authClassCode,{},function(result){result.success?($(".privileges").each(function(i,o){for(var exists=!1,f=0;f<result.rows.length;f++)if($(o).prop("outerHTML")==$(eval(result.rows[f])).prop("outerHTML")){exists=!0;break}exists||$(o).removeClass("privileges")}),$(result.hasRows||[]).each(function(i,o){$(eval(o)).removeClass("privileges")})):Mom.layAlert(result.message)}):Mom.layMsg("请在要权限控制的元素上添加privileges类名")}function getOperPermitPlus(e,t){var n=Const.admin+"/api/imp/sys/UserPermission/currentUserOperation",o={authClassCode:e};Api.ajaxForm(n,o,function(e){e.success?t&&t(e.rows):Mom.layAlert("查询属性权限失败！"+e.message)})}function getAttrPermit(e,t,n){Api.ajaxForm(Const.admin+"/api/imp/sys/UserPermission/permissionList",{authClassCode:e,apCode:t},function(e){e.success?n(e.rows):Mom.layAlert(e.message)})}function getAtrrTreePermit(e,t,n){Api.ajaxForm(Const.admin+"/api/imp/sys/UserPermission/permissionTree",{authClassCode:e,apCode:t},function(e){e.success?n(e.rows):Mom.layAlert(e.message)})}function getAttaType(e){return e.indexOf("image")>-1?"image":e.indexOf("doc")>-1||e.indexOf("docx")>-1?"doc":e.indexOf("xls")>-1||e.indexOf("xlsx")>-1?"xls":e.indexOf("ppt")>-1||e.indexOf("pptx")>-1?"ppt":e.indexOf("pdf")>-1?"pdf":e.indexOf("zip")>-1||e.indexOf("rar")>-1?"rar":e.indexOf("audio")>-1?"audio":e.indexOf("video")>-1?"video":e.indexOf("txt")>-1?"txt":"file"}function loadSkin(e){""==e&&(e="default");var t=cdnDomain+"/skin/"+e+"/css/"+e+".css";if($("#skin").length>0){var n=Mom.top();$("#skin").attr("href",t),$("#skin",n.document).attr("href",t);var o=$(".J_iframe",n.document);$.each(o,function(e,n){$("#skin",n.contentWindow.document).attr("href",t)})}else include([{id:"skin",url:t}])}var windowOpen=function(e,t,n,o){var i=parseInt((window.screen.height-o)/2,10),a=parseInt((window.screen.width-n)/2,10),r="location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes,width="+n+",height="+o+",top="+i+",left="+a;window.showModalDialog?window.showModalDialog(e,t,r):n&&o?window.open(e,t,r):window.open(e,t)},windowOpenPost=function(e,t,n){var o=document.createElement("form");if(o.action=e,o.method="post",o.style.display="none",n&&(o.target=n),t)for(var i in t){var a=document.createElement("input");a.name=i,a.value=t[i],o.appendChild(a)}document.body.appendChild(o),o.submit(),document.body.removeChild(o)},openTab=function(e,t,n){Mom.crossOrigin?n?window.open(t):location.href=t:Mom.top().TabsNav.openTab(e,t,n)},openDialog=function(e,t,n,o,i){null!=n&&""!=n||(n="800px"),null!=o&&""!=o||(o="500px");var a=[];i&&("[object Array]"===Object.prototype.toString.call(i)?a=i:a.push({btn:"确定",fn:i}));var r={btnArr:a};return openDialogCfg(e,t,n,o,r)},openEditDialog=function(e,t,n,o,i){null!=e&&""!=e||(e="修改");var a=openDialog(e,t,n,o,i||function(e,t){var n=Mom.top(),o=(n.layer.getChildFrame("body",e),t.find("iframe")[0].contentWindow),i=!1;try{i=o.doSubmit(e,t),console.warn("%cYou need to customize a callback function instead of using the default: %cdoSubmit()","color:red;font-size:16px","color:blue")}catch(e){window.alert(e.message)}return i});return a},openSideWin=function(e,t,n,o,i,a){var r=71,s=$(body).outerWidth(!0)-Number(String(n).replace("px","")),l=$(body).outerHeight(!0)-r-1+"px",c=[];i&&("[object Array]"===Object.prototype.toString.call(i)?c=i:c.push({btn:"确定",fn:i}));var p={btnAlign:"c",closeBtn:null!=e?1:0,shade:o,shadeClose:!1,maxmin:!1,move:!1,anim:2,skin:"",offset:[r+"px",s+"px"],btnArr:c};return a&&(p=$.extend(!0,{},p,a)),openDialogCfg(e,t,n,l,p)},openDialogCfg=function(e,t,n,o,i){i=i||{};var a=i._target||Mom.top(),r={type:2,area:[n,o],title:null!=e&&e,maxmin:!0,content:t,skin:Const.layerSkin()||"",btn:[]},s=!0,l=[];0==$.isEmptyObject(i)&&(r=$.extend(!0,{},r,i),i.btnArr&&i.btnArr.length>0?l=i.btnArr.concat():!1===i.btnArr&&(s=!1)),"2"==r.type&&(r.success=r.success||function(e,t){var n=e.find("iframe")[0].contentWindow;"auto"==o&&a.layer.iframeAuto(t),$(".closeBtn",n.document).each(function(e,n){var o=$(n).prop("outerHTML"),i=o.match(/\([^\)]*\)/g);null!=i&&"()"!=i||$(n).unbind("click").click(function(){return a.layer.close(t),!1})})}),s&&($(l).each(function(e,t){1==t.cancel&&(t.btn=t.btn||"关闭",s=!1)}),1==s&&l.push({btn:"关闭"})),$(l).each(function(e,t){r.btn.push(t.btn),r["btn"+(e+1)]=function(e,n){var o=t.fn;if(o){var i=window;"2"==r.type&&(i=n.find("iframe")[0].contentWindow),"string"==typeof o&&(o=i[o]);var s=o(e,n);if(0==s)return!1;setTimeout(function(){a.layer.close(e)},200)}else a.layer.close(e)}});var c=a.layer.open(r);return c},openOrgSelect=function(e,t,n,o,i){var a={url:Const.admin+"/api/sys/SysOrg/orgTree",data:t||{}};return openTreeSelect(e||"选择机构",a,n,o,i)},openTreeSelect=function(e,t,n,o,i){var a=t.url,r=t.data||{},s=t.contentType;"Json"==s?r=JSON.stringify(r):s="Form",a?Api["ajax"+s](a,r,function(t){t.success?openTreeDataSelect(e,t.rows,n,o,i):Mom.layAlert(t.message)}):Mom.layAlert("url不能为空")},openTreeDataSelect=function(e,t,n,o,i){var a=Mom.top(),r=["确定"];i&&r.push("清空"),r.push("关闭");var s=n.width||"300px",l=n.height||"424px",c=n.htmlUrl||cdnDomain+"/pages/common/treeSelect.html",p={multiple:null!=n.multiple&&n.multiple,noRoot:null!=n.noRoot&&n.noRoot,onlyLeaf:null!=n.onlyLeaf&&n.onlyLeaf,showSearch:null==n.showSearch||n.showSearch},u={type:2,btn:r,maxmin:!1,shade:[.4,"#000"],title:e||"请选择",skin:Const.layerSkin()||"",area:[s,l],content:Mom.extractUrl(c,p),success:function(e,o){var i=e.find("iframe")[0].contentWindow;i.setConfigData(t,n.defaultVals||"",n.setting,n.saveApi||{},n.deleteApi||{}),i.load()},yes:function(e,t){var n=t.find("iframe")[0].contentWindow,i=n.getCheckValues();if(i.success){var r=!0;o&&(r=o(i,e,t)),r&&a.layer.close(e)}}};return i&&(u.btn2=function(e,t){return i(e,t),!0}),a.layer.open(u)},openSelUserWin=function(e,t,n,o,i){var a=Mom.top(),r=["确定"];i&&r.push("清空"),r.push("关闭");var s=n.width||"840px",l=n.height||"600px",c=n.htmlUrl||cdnDomain+"/pages/common/userSelect.html",p={multiple:null!=n.multiple&&n.multiple};$.extend(t||{},{url:Const.admin+"/api/sys/SysUser/page",data:{}});var u={type:2,btn:r,maxmin:!1,shade:[.4,"#000"],title:e||"选择用户",area:[s,l],skin:Const.layerSkin()||"",content:Mom.extractUrl(c,p),success:function(e,o){var i=e.find("iframe")[0].contentWindow;i.setConfig(t.url,t.data,n.defaultVals||""),i.load()},yes:function(e,t){var n=t.find("iframe")[0].contentWindow,i=n.getCheckValues();if(i.success){var r=!0;o&&(r=o(i,e,t)),r&&a.layer.close(e)}}};return i&&(u.btn2=function(e,t){return i(e,t),!0}),a.layer.open(u)},openSelUserWin2=function(e,t,n,o,i){t=null!=t&&t;var a={noRoot:!0,multiple:t,defaultVals:n,htmlUrl:cdnDomain+"/pages/common/treeSelect.html?oper=user"};return openOrgSelect(e,{},a,o,i)},openSelUserWin3=function(e,t,n,o){var i=Mom.top(),a=["确定"];o&&a.push("清空"),a.push("关闭");var r=t.width||"800px",s=t.height||"545px",l=t.htmlUrl||cdnDomain+"/pages/common/userSelect3.html",c={multiple:null==t.multiple||t.multiple,showSearch:null==t.showSearch||t.showSearch,checkType:null==t.checkType?"0":t.checkType,checkChange:null==t.checkChange||t.checkChange};t.orgOptions={apiCfg:$.extend(!0,{},{url:Const.admin+"/api/sys/SysOrg/orgTree",data:{},contentType:"Json"},(t.orgOptions||{}).apiCfg),settting:(t.orgOptions||{}).settting},t.waitUserOptions={apiCfg:$.extend(!0,{},{url:Const.admin+"/api/sys/SysUser/list",data:{},contentType:"Json"},(t.waitUserOptions||{}).apiCfg),settting:(t.waitUserOptions||{}).settting};var p={type:2,btn:a,maxmin:!1,shade:[.4,"#000"],title:e||"请选择",skin:Const.layerSkin()||"",area:[r,s],content:Mom.extractUrl(l,c),success:function(e,n){var o=e.find("iframe")[0].contentWindow;o.setConfig(t.orgOptions,t.waitUserOptions,t.hasUserOptions),o.load()},yes:function(e,t){var o=t.find("iframe")[0].contentWindow,a=o.getCheckValues();if(a.success){var r=!0;n&&(r=n(a,e,t)),r&&i.layer.close(e)}else Mom.layMsg(a.message)}};return o&&(p.btn2=function(e,t){return o(e,t),!0}),i.layer.open(p)},openIconSelect=function(e,t){var n=Mom.top();e=e||"";var o={type:2,maxmin:!0,title:"选择图标",skin:Const.layerSkin()||"",area:["860px","70%"],content:cdnDomain+"/pages/common/iconSelect.html?selVal="+e,btn:["确定","关闭"]};return t&&(o.yes=function(e,o){var i=o.find("iframe")[0].contentWindow,a=$("#iconSelected",i.document).val(),r=!1;""!=a?r=t(a,e,o):Mom.layMsg("请选择图标"),r&&n.layer.close(e)}),n.layer.open(o)};window.doSubmit=function(e,t){if(!Validator.valid(document.forms[0],1.3))return!1;var n=$("#inputForm"),o=n.attr("action"),i=n.serializeJSON();return Api.ajaxJson(o,JSON.stringify(i),function(t){1==t.success?(Mom.layMsg("操作成功",1e3),setTimeout(function(){var t=Mom.top().TabsNav.getActiveTab(),n=$("#search-btn,#btn-search",t[0].contentDocument);0==n.length&&(n=$("#refresh-btn",t[0].contentDocument),0==n.length&&Mom.top().TabsNav.refreshActiveTab()),n.trigger("click"),Mom.top().layer.close(e)},500)):Mom.layAlert(t.message)}),!1};var editCheckedTable=function(e,t,n,o,i,a){var r=[];if($(i+" tbody tr").each(function(e,t){var n=$(t).find("td:first input.i-checks");if(n&&1==n.is(":checked")){var o=n.attr("id")||n.val();r.push(o)}}),1!=r.length)return Mom.layMsg("请选择一条数据"),!1;t=Mom.extractUrl(t,"id="+r[0]);openEditDialog(e,t,n,o,a)},postFormConfirm=function(e,t,n,o,i){var a=Mom.top();Mom.layConfirm(e,function(e){a.layer.close(e),layer.close(e),Api.ajaxForm(t,n||{},function(t){if(o)o(t,e,n);else if(1==t.success){Mom.layMsg("操作成功");var i=a.TabsNav.getActiveTab(),r=$("#search-btn,#btn-search",i[0].contentDocument);0==r.length&&(r=$("#refresh-btn",i[0].contentDocument),0==r.length&&a.TabsNav.refreshActiveTab()),r.trigger("click")}else Mom.layAlert(t.message)})},i)},deleteItem=function(e,t,n,o){return postFormConfirm(e,t,n,o),!1},getDictLabel=function(e,t,n){for(var o=0;o<e.length;o++){var i=e[o];if(i.value==t)return i.label}return n||t},setPageView=function(e,t){if("view"==e){t||(t=$(document.forms[0])),$(t).find("input[type!=hidden],select,textarea,radio,checkbox").attr("disabled","true").addClass("disabled");var n=document.getElementById("ueditor_0");if(n){var o=n.contentDocument||n.contentWindow.document;$(o.body).attr("contenteditable","false")}}};return{windowOpen:windowOpen,windowOpenPost:windowOpenPost,openTab:openTab,openDialog:openDialog,openEditDialog:openEditDialog,openSideWin:openSideWin,openDialogCfg:openDialogCfg,openOrgSelect:openOrgSelect,openTreeSelect:openTreeSelect,openTreeDataSelect:openTreeDataSelect,openSelUserWin:openSelUserWin,openSelUserWin2:openSelUserWin2,openSelUserWin3:openSelUserWin3,openIconSelect:openIconSelect,deleteItem:deleteItem,delCheckTable:delCheckTable,editCheckedTable:editCheckedTable,postCheckData:postCheckData,postFormConfirm:postFormConfirm,getDictLabel:getDictLabel,createSelect:createSelect,resetSelect:resetSelect,appendOptionsValue:appendOptionsValue,appendOptions:appendOptions,getOperPermit:getOperPermit,getOperPermitPlus:getOperPermitPlus,getAttrPermit:getAttrPermit,getAtrrTreePermit:getAtrrTreePermit,setPageView:setPageView,getAttaType:getAttaType,loadSkin:loadSkin}}();